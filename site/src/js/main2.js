// Generated by CoffeeScript 1.6.3
(function(){var e,t,n;t=angular.module("dssApp",[]);n="http://localhost:2480/functional";e="http://localhost:2480/csd";t.factory("dataFactory",function(){var t,n,r;t=new ODatabase(e);n=t.open("admin","admin");r={};r.getAllRequirements=function(){var e;e=t.query("select from Requirements",1e3);return e.result};r.catchMatching=function(e){e=t.query(e,30);return e.result};t.close();return r});t.filter("capitalize",function(){return function(e,t){return e.substring(0,1).toUpperCase()+e.substring(1)}});t.filter("replaceSpacesWithDash",function(){return function(e,t){return e.replace(/\ /g,"_")}});t.filter("replaceDotWithDash",function(){return function(e,t){return e.replace(/\./g,"_")}});t.filter("replaceDashWithSpace",function(){return function(e,t){return e.replace(/_/g," ")}});t.filter("replaceDashWithDot",function(){return function(e,t){return e.replace(/_/g,".")}});t.filter("unique",function(){return function(e,t){var n,r,i;if(t===!1)return e;if((t||angular.isUndefined(t))&&angular.isArray(e)){r={};i=[];n=function(e){return angular.isObject(e)&&angular.isString(t)?e[t]:e};angular.forEach(e,function(t){var r,s,o,u;r=!1;for(o=0,u=i.length;o<u;o++){s=i[o];if(angular.equals(n(s),n(t))){r=!0;break}}r||i.push(t);e=i})}return e}});t.directive("render",function(){return function(e,t,n){return n.$observe("parameters",function(r){var i,s,o;i=e.$eval("{"+n.parameters+"}");o=n.render;if(o==="slider")return{restrict:"A",link:t.noUiSlider({range:i.range||[0,100],start:i.start||0,step:i.step||1,handles:i.handles||1,slide:function(){return $(this).prev("span.requirementValue").text($(this).val())}})};if(o==="select"){s='<option value="none">-- select --</option>';angular.forEach(i,function(e,t){s=s+'<option value="'+t+'">'+e+"</option>"});return{restrict:"E",replace:!0,template:t.html('<label for="'+t.text()+'">'+t.text()+' <span data-tooltip class="has-tip tip-top" title="'+e.item.definition+'"><i class="fi-lightbulb"></i></span></label><select name="'+t.text()+'">'+s+"</select>")}}if(o==="input")return{restrict:"E",replace:!0,template:t.html('<label for="'+t.text()+'">'+t.text()+' <span data-tooltip class="has-tip tip-top" title="'+e.item.definition+'"><i class="fi-lightbulb"></i></span></label><input name="'+t.text()+'" type='+i.type+' class="large-12 columns" ng-model="'+t.text()+'" ng-change="change()">')};if(o==="radio")return{restrict:"E",replace:!0,template:t.html('<label for="'+t.text()+'">'+t.text()+' <span data-tooltip class="has-tip tip-top" title="'+e.item.definition+'"><i class="fi-lightbulb"></i></span></label><div class="switch small"><input id="z" name="'+t.text()+'" type="radio" checked><label for="z" onclick="">NO</label><input id="z1" name="'+t.text()+'" type="radio"><label for="z1" onclick="">YES</label><span></span></div>')};console.log("ouch");$(document).foundation()})}});t.directive("reqInput",function(){return{restrict:"E",replace:!0,link:function(e,t,n){var r,i,s;r=e.$eval("{"+e.item.attributes+"}");i=r.placeholder||"";s=r.type||"text";t.html('<label for="'+e.item.name+'">'+e.item.name+' <span data-tooltip class="has-tip tip-top" title="'+e.item.definition+'"><i class="fi-lightbulb"></i></span></label><input name="'+e.item.linkName+'" type="'+s+'" class="large-12 columns query" placeholder="'+i+'">');return t.bind("change",function(){return e.change()})}}});t.directive("reqRadio",function(){return{restrict:"E",replace:!0,link:function(e,t,n){var r;r=e.$eval("{"+e.item.attributes+"}");t.html('<label for="'+e.item.name+'">'+e.item.name+' <span data-tooltip class="has-tip tip-top" title="'+e.item.definition+'"><i class="fi-lightbulb"></i></span></label><div class="switch small radius      query" name="'+e.item.linkName+'"><input id="0" name="'+e.item.name+'" type="radio" checked><label for="z" onclick="">'+r[0]+'</label><input id="1" name="'+e.item.name+'" type="radio"><label for="z1" onclick="">'+r[1]+"</label><span></span></div>");return t.bind("click",function(){return e.change()})}}});t.directive("reqSelect",function(){return{restrict:"E",replace:!0,link:function(e,t,n){var r,i;r=e.$eval("{"+e.item.attributes+"}");i='<option value="none">-- select --</option>';angular.forEach(r,function(e,t){i=i+'<option value="'+t+'">'+e+"</option>"});t.html('<label for="'+e.item.name+'">'+e.item.name+' <span data-tooltip class="has-tip tip-top" title="'+e.item.definition+'"><i class="fi-lightbulb"></i></span></label><select name="'+e.item.linkName+'" class="query">'+i+"</select>");return t.bind("change",function(){return e.change()})}}});t.directive("reqSlider",function(){return{restrict:"E",replace:!0,link:function(e,t,n){var r;r=e.$eval("{"+e.item.attributes+"}");t.html('        <label style="margin-bottom: 5px;">'+e.item.name+'<span data-tooltip class="has-tip tip-top" title="'+e.item.definition+'">        <i class="fi-lightbulb"></i></span></label>        <span class="label secondary radius right requirementValue">-</span>        <div style="width: 80%; margin-bottom: 15px;" class="noUiSlider"></div>      ');return t.find("div.noUiSlider").noUiSlider({range:r.range||[0,100],start:r.start||0,step:r.step||1,handles:r.handles||1,slide:function(){return $(this).prev("span.requirementValue").text($(this).val())}})}}});t.controller("dssCtrl",function(e,t){e.queryElements=[];e.selectedServices=[];e.selectedServicesEdges=[];e.requirements=t.getAllRequirements();e.showSubcategory=function(e){$(document).foundation();$(".thirdLevelRequirements").hide();return $("#"+e).fadeIn()};e.closeSubcategory=function(e){return $("."+e).fadeOut()};e.addElementToQuery=function(t){var n;n=$("select."+t).val();return angular.forEach(e.requirements,function(r){if(r.category===t&&r.name===n&&e.queryElements.indexOf(r)===-1)return e.queryElements.push(r)})};e.change=function(){var n;n="select from Services where 1=1";$(".query").each(function(){var e,t,r,i,s,o;e=$(this);i=e.get(0).tagName;r=e.attr("name");switch(i){case"SELECT":s=e.val();if(s!=="none"){o=" AND "+r+" = "+s+"";return n+=o}break;case"INPUT":s=e.val();if(s){o=" AND "+r+" = '"+s+"'";return n+=o}break;case"DIV":if(e.hasClass("noUiSlider"))return console.log("slider");if(e.hasClass("switch")){t=e.find("input");return t.each(function(){var e;e=$(this);if(e.is(":checked")){s=e.attr("id");o=" AND "+r+" = "+s;return n+=o}})}break;default:return console.log(i)}});n.search("AND")!==-1&&(e.matchingServices=t.catchMatching(n));console.log(n);console.log(e.matchingServices);return e.selected=function(t){var n,r;n=$("#service-"+t);r=$(this);n.toggleClass("selected");e.selectedServices.push(r);return console.log(e.selectedServices)}};return e.$watch("selectedServices",function(n){var r;r="select from Services where 1=1";angular.forEach(e.selectedServices,function(e){});console.log(e.selectedServices);if(e.selectedServices.length)return e.selectedServicesEdges=t.matchingServices(r)})},$(document).foundation())}).call(this);